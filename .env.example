# =============================================================================
# KURA Notes - Environment Configuration
# =============================================================================
# Copy this file to .env and fill in your actual values
# IMPORTANT: Never commit .env to version control
#
# LEGEND:
#   [REQUIRED]          - Must be set for application to start
#   [REQUIRED-PROD]     - Must be set in production
#   [OPTIONAL]          - Can be left empty, has sensible defaults
#   [DOCKER-ONLY]       - Only used when running with Docker
# =============================================================================

# -----------------------------------------------------------------------------
# Application Settings
# -----------------------------------------------------------------------------

# [OPTIONAL] Environment: development, production, or test
# Default: development
# Production enables stricter validation and security checks
NODE_ENV=development

# [OPTIONAL] Port for the API server
# Default: 3000
# Must be a valid port number (1-65535)
API_PORT=3000

# -----------------------------------------------------------------------------
# Security & Authentication
# -----------------------------------------------------------------------------

# [DEPRECATED] API Key for securing endpoints
# NOTE: API key authentication is deprecated in favor of KOauth
# MIGRATION: This is kept temporarily for backward compatibility
# SECURITY: Must be changed from default in production!
# SECURITY: Should be at least 32 characters long
# Generate: openssl rand -hex 32
# Generate: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# Development default: dev-api-key-change-in-production
API_KEY=your-api-key-here

# [REQUIRED] KOauth Authentication Server URL
# Production: https://auth.tillmaessen.de
# Local development: http://localhost:3001 (if running KOauth locally)
# Format: Must be a valid HTTP/HTTPS URL
# This is the URL of your KOauth authentication server
KOAUTH_URL=https://auth.tillmaessen.de

# [OPTIONAL] KOauth timeout in milliseconds
# Default: 5000 (5 seconds)
# How long to wait for KOauth server responses
KOAUTH_TIMEOUT=5000

# [REQUIRED] OAuth 2.0 Client Configuration
# Register your application with KOauth to get these credentials
# See KOauth documentation: docs/OAUTH_INTEGRATION.md
OAUTH_CLIENT_ID=kura-notes
OAUTH_CLIENT_SECRET=
OAUTH_REDIRECT_URI=https://kura.tillmaessen.de/oauth/callback

# -----------------------------------------------------------------------------
# KOauth Service Configuration (Docker Compose Only)
# -----------------------------------------------------------------------------
# These variables are only needed if running KOauth service in Docker Compose

# [REQUIRED-PROD] PostgreSQL database name for KOauth
# Default: koauth
KOAUTH_DB_NAME=koauth

# [REQUIRED-PROD] PostgreSQL user for KOauth
# Default: koauth
KOAUTH_DB_USER=koauth

# [REQUIRED-PROD] PostgreSQL password for KOauth
# SECURITY: Must be a strong password in production!
# Generate: openssl rand -hex 32
KOAUTH_DB_PASSWORD=

# [REQUIRED-PROD] KOauth session secret for JWT signing
# SECURITY: Must be a strong random secret in production!
# Generate: openssl rand -hex 64
KOAUTH_SESSION_SECRET=

# [OPTIONAL] KOauth service port
# Default: 3001
# Note: KOauth internally runs on port 3000, this is the external port mapping
KOAUTH_PORT=3001

# [REQUIRED-PROD] KOauth base URL (publicly accessible URL)
# Production: https://auth.tillmaessen.de
# Local: http://localhost:3001
KOAUTH_BASE_URL=https://auth.tillmaessen.de

# [REQUIRED-PROD] Allowed callback URLs (comma-separated)
# Where KOauth can redirect after authentication
# Example: https://kura.tillmaessen.de,https://kura.tillmaessen.de/auth/callback
KOAUTH_ALLOWED_CALLBACKS=https://kura.tillmaessen.de

# [OPTIONAL] Google OAuth configuration
# Get credentials from: https://console.cloud.google.com/apis/credentials
# Create OAuth 2.0 Client ID for Web application
# Authorized redirect URIs: https://auth.tillmaessen.de/auth/google/callback
KOAUTH_GOOGLE_CLIENT_ID=
KOAUTH_GOOGLE_CLIENT_SECRET=

# [OPTIONAL] GitHub OAuth configuration
# Get credentials from: https://github.com/settings/developers
# Create OAuth App
# Authorization callback URL: https://auth.tillmaessen.de/auth/github/callback
KOAUTH_GITHUB_CLIENT_ID=
KOAUTH_GITHUB_CLIENT_SECRET=

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------

# [OPTIONAL] SQLite database file path (relative or absolute)
# Default: ./data/metadata/knowledge.db
# Relative paths are resolved from project root
# Directory will be created automatically if it doesn't exist
DATABASE_URL=./data/metadata/knowledge.db

# -----------------------------------------------------------------------------
# Vector Store Configuration
# -----------------------------------------------------------------------------

# [REQUIRED] ChromaDB HTTP API endpoint
# Local development: http://localhost:8000
# Docker Compose: http://vectordb:8000
# Production: Your ChromaDB server URL
# Format: Must be a valid HTTP/HTTPS URL
VECTOR_STORE_URL=http://localhost:8000

# [OPTIONAL] ChromaDB authentication key
# Leave empty for local development without auth
# Required in production if ChromaDB has authentication enabled
# Generate: openssl rand -hex 32
VECTOR_DB_KEY=

# -----------------------------------------------------------------------------
# OpenAI Configuration
# -----------------------------------------------------------------------------

# [REQUIRED-PROD] OpenAI API key for generating embeddings
# Get your key from: https://platform.openai.com/api-keys
# Format: sk-... (starts with 'sk-')
# COST: Embeddings cost ~$0.00002 per 1K tokens (~$0.10 per 1M tokens)
# NOTE: Application will work without this, but search won't function
OPENAI_API_KEY=

# [OPTIONAL] Embedding model to use
# Default: text-embedding-3-small (1536 dimensions, cheapest)
# Options: text-embedding-3-small, text-embedding-3-large, text-embedding-ada-002
# Recommendation: Use text-embedding-3-small for production (best cost/performance)
OPENAI_EMBEDDING_MODEL=text-embedding-3-small

# -----------------------------------------------------------------------------
# File Storage Configuration
# -----------------------------------------------------------------------------

# [OPTIONAL] Base directory for storing uploaded files
# Default: ./data/content
# Directory will be created automatically if it doesn't exist
# Files are organized as: YYYY/MM/DD/UUID.ext
STORAGE_BASE_PATH=./data/content

# [OPTIONAL] Maximum file size in bytes
# Default: 52428800 (50MB)
# Common values: 10485760 (10MB), 52428800 (50MB), 104857600 (100MB)
# Format: Must be a positive integer
MAX_FILE_SIZE=52428800

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------

# [OPTIONAL] Log level: error, warn, info, debug
# Default: info
# Production recommendation: info or warn
# Development recommendation: debug
# Format: Must be one of: error, warn, info, debug
LOG_LEVEL=info

# [OPTIONAL] Log directory
# Default: ./data/logs
# Directory will be created automatically if it doesn't exist
# Logs rotate daily, 7-day retention for general logs, 30-day for errors
LOG_DIR=./data/logs

# -----------------------------------------------------------------------------
# CORS Configuration
# -----------------------------------------------------------------------------

# [OPTIONAL] Allowed origins (comma-separated for multiple)
# Default: * (allow all)
# SECURITY: Restrict in production to your actual domain!
# Examples:
#   Single domain: https://your-domain.com
#   Multiple domains: https://app.example.com,https://admin.example.com
#   Local + prod: http://localhost:3000,https://your-domain.com
# Production recommendation: Specify exact domain(s)
CORS_ORIGIN=*

# -----------------------------------------------------------------------------
# TLS/SSL Configuration (Production Only)
# -----------------------------------------------------------------------------

# [OPTIONAL] Path to TLS/SSL certificate file
# Required for HTTPS support
# Format: Absolute path to .pem or .crt file
# Example: /etc/ssl/certs/your-domain.pem
# TLS_CERT_PATH=

# [OPTIONAL] Path to TLS/SSL private key file
# Required for HTTPS support
# Format: Absolute path to .pem or .key file
# Example: /etc/ssl/private/your-domain-key.pem
# SECURITY: Protect this file with appropriate permissions (chmod 600)
# TLS_KEY_PATH=

# -----------------------------------------------------------------------------
# Docker Configuration (Docker Compose Only)
# -----------------------------------------------------------------------------

# [DOCKER-ONLY] Vector database port (ChromaDB)
# Default: 8000
# Only used in docker-compose.yml for port mapping
VECTOR_DB_PORT=8000

# [DOCKER-ONLY] ChromaDB authentication provider
# Leave as-is unless you have custom ChromaDB auth configuration
CHROMA_SERVER_AUTH_PROVIDER=chromadb.auth.token.TokenAuthServerProvider

# [DOCKER-ONLY] ChromaDB authentication credentials/token
# Generate: openssl rand -hex 32
# Must match VECTOR_DB_KEY if using authentication
CHROMA_SERVER_AUTH_CREDENTIALS=your-chroma-token-here

# [DOCKER-ONLY] ChromaDB authentication header name
# Leave as default unless you have custom ChromaDB configuration
CHROMA_SERVER_AUTH_TOKEN_TRANSPORT_HEADER=X-Chroma-Token

# [DOCKER-ONLY] Disable ChromaDB telemetry
# Default: FALSE (telemetry disabled)
# Set to TRUE to enable telemetry
ANONYMIZED_TELEMETRY=FALSE

# =============================================================================
# Production Checklist
# =============================================================================
# Before deploying to production, ensure:
#
# 1. ✅ NODE_ENV=production
# 2. ✅ KOAUTH_URL is set (https://auth.tillmaessen.de)
# 3. ✅ KOAUTH_DB_PASSWORD generated (openssl rand -hex 32)
# 4. ✅ KOAUTH_SESSION_SECRET generated (openssl rand -hex 64)
# 5. ✅ KOAUTH_BASE_URL configured with public URL
# 6. ✅ DNS A record for auth.tillmaessen.de points to server IP
# 7. ✅ OAuth providers configured (Google and/or GitHub)
# 8. ✅ KOAUTH_ALLOWED_CALLBACKS includes your kura-notes URL
# 9. ✅ OPENAI_API_KEY is set (from https://platform.openai.com/api-keys)
# 10. ✅ VECTOR_STORE_URL points to your ChromaDB server
# 11. ✅ CORS_ORIGIN is restricted to your domain(s)
# 12. ✅ LOG_LEVEL is set to info or warn
# 13. ✅ All file paths are absolute or properly resolved
# 14. ✅ TLS/SSL certificates configured (use reverse proxy like Caddy/Nginx)
# 15. ✅ Database and storage directories have proper permissions
# 16. ✅ Regular backups configured (see docs/backup.md)
# 17. ✅ Database migration for user_id completed
# 18. ✅ Legacy data migrated to user accounts
#
# Run: npm run setup (or scripts/setup.sh) to validate configuration
# =============================================================================
